/*! For license information please see main.7599900e9027e2e4dc35.js.LICENSE.txt */
(()=>{"use strict";var t,e={91:(t,e,n)=>{var r=n(143);function o(t){var e=new Date(t),n=e.getDay(),r=e.getDate()-n+(0===n?-6:1),o=new Date(e.setDate(r));return o.setHours(0,0,0,0),o}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,c,i=[],s=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l(t,e,n){return(e=g(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof i?r:i,u=Object.create(s.prototype);return h(u,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,h={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return a=e,i=0,s=t,h.n=n,c}};function f(n,r){for(i=n,s=r,e=0;!d&&u&&!o&&e<l.length;e++){var o,a=l[e],f=h.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=f&&((o=n<2&&f<a[1])?(i=0,h.v=r,h.n=a[1]):f<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,h.n=v,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),i=l,s=v;(e=i<2?t:s)||!d;){a||(i?i<3?(i>1&&(h.n=-1),f(i,s)):h.n=s:h.v=s);try{if(u=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(d=h.n<0)?s:n.call(r,h))!==c)break}catch(e){a=t,i=1,s=e}finally{u=1}}return{value:e,done:d}}}(n,o,a),!0),u}var c={};function i(){}function s(){}function u(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(h(e={},r,function(){return this}),e),f=u.prototype=i.prototype=Object.create(l);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,h(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return s.prototype=u,h(f,"constructor",u),h(u,"constructor",s),s.displayName="GeneratorFunction",h(u,o,"GeneratorFunction"),h(f),h(f,o,"Generator"),h(f,r,function(){return this}),h(f,"toString",function(){return"[object Generator]"}),(d=function(){return{w:a,m:v}})()}function h(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}h=function(t,e,n,r){function a(e,n){h(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},h(t,e,n,r)}function f(t,e,n,r,o,a,c){try{var i=t[a](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,o)}function v(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){f(a,r,o,c,i,"next",t)}function i(t){f(a,r,o,c,i,"throw",t)}c(void 0)})}}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function g(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}function y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(y=function(){return!!t})()}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}var b="today",k="yesterday",D="thisWeek",E="thisMonth",S="thisYear";function L(t){var e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate());switch(t){case b:return{start:new Date(n),end:new Date(n.getTime()+864e5)};case k:var r=new Date(n);return r.setDate(n.getDate()-1),{start:r,end:new Date(n)};case D:var a=o(e),c=new Date(a);return c.setDate(a.getDate()+7),{start:a,end:c};case"lastWeek":var i=o(e);i.setDate(i.getDate()-7);var s=new Date(i);return s.setDate(i.getDate()+7),{start:i,end:s};case E:return{start:new Date(e.getFullYear(),e.getMonth(),1),end:new Date(e.getFullYear(),e.getMonth()+1,1)};case"lastMonth":return{start:new Date(e.getFullYear(),e.getMonth()-1,1),end:new Date(e.getFullYear(),e.getMonth(),1)};case S:return{start:new Date(e.getFullYear(),0,1),end:new Date(e.getFullYear()+1,0,1)};case"last7Days":var u=new Date(e);return u.setDate(e.getDate()-7),{start:u,end:e};case"last30Days":var l=new Date(e);return l.setDate(e.getDate()-30),{start:l,end:e};default:throw new Error("Неизвестный тип диапазона: ".concat(t))}}var N=new(function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(t,e,n){return e=m(e),function(t,e){if(e&&("object"==a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,y()?Reflect.construct(e,n||[],m(t).constructor):e.apply(t,n))}(this,e,["TimeArchive"])).version(1).stores({notes:"++id, date, content, tags"}),t.notes=t.table("notes"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(e,t),n=e,r=[{key:"addNote",value:(K=v(d().m(function t(e){var n,r,o,a,c=arguments;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:[],t.p=1,r={content:e.trim(),tags:Array.isArray(n)?n:[],date:new Date},t.n=2,this.notes.add(r);case 2:return o=t.v,console.log("Запись добавлена с ID: ".concat(o)),t.a(2,o);case 3:throw t.p=3,a=t.v,console.error("Ошибка при добавлении записи:",a),a;case 4:return t.a(2)}},t,this,[[1,3]])})),function(t){return K.apply(this,arguments)})},{key:"deleteNote",value:($=v(d().m(function t(e){var n;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.notes.delete(e);case 1:console.log("Запись с ID: ".concat(e," удалена")),t.n=3;break;case 2:throw t.p=2,n=t.v,console.error("Ошибка при удалении записи с ID ".concat(e,":"),n),n;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return $.apply(this,arguments)})},{key:"getNotesByDateRange",value:(G=v(d().m(function t(e,n){var r,o,a,c=arguments;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],o=c.length>3&&void 0!==c[3]&&c[3],t.p=1,t.n=2,this.notes.where("date").between(e,n,r,o).reverse().toArray();case 2:return t.a(2,t.v);case 3:throw t.p=3,a=t.v,console.error("Ошибка получения записей по диапазону:",a),a;case 4:return t.a(2)}},t,this,[[1,3]])})),function(t,e){return G.apply(this,arguments)})},{key:"getTodayNotes",value:(U=v(d().m(function t(){var e,n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return e=L(b),n=e.start,r=e.end,t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return U.apply(this,arguments)})},{key:"getYesterdayNotes",value:(q=v(d().m(function t(){var e,n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return e=L(k),n=e.start,r=e.end,t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return q.apply(this,arguments)})},{key:"searchNotes",value:(_=v(d().m(function t(e){var n,r,o,a,c,i,s,u,l,h,f,v,p,g,y,m,w,b,k,D,E=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:if(n=E.length>1&&void 0!==E[1]?E[1]:{},e&&0!==e.trim().length){t.n=1;break}return t.a(2,[]);case 1:return r=n.caseSensitive,o=void 0!==r&&r,a=n.searchInContent,c=void 0===a||a,i=n.searchInTags,s=void 0===i||i,u=n.exactMatch,l=void 0!==u&&u,h=n.limit,f=void 0===h?100:h,v=n.dateFrom,p=void 0===v?null:v,g=n.dateTo,y=void 0===g?null:g,m=o?e.trim():e.trim().toLowerCase(),w=this.notes.toCollection(),(p||y)&&(b=p||new Date("1970-01-01"),k=y||new Date("2099-12-31"),w=this.notes.where("date").between(b,k,!0,!0)),t.n=2,w.filter(function(t){var e=!1,n=!1;if(c){var r=o?t.content:t.content.toLowerCase();e=l?r===m:r.includes(m)}return s&&t.tags.length>0&&(n=t.tags.some(function(t){var e=o?t:t.toLowerCase();return l?e===m:e.includes(m)})),e||n}).reverse().limit(f).toArray();case 2:return D=t.v,t.a(2,D)}},t,this)})),function(t){return _.apply(this,arguments)})},{key:"searchByTags",value:(V=v(d().m(function t(e){var n,r,o=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:if(n=o.length>1&&void 0!==o[1]&&o[1],Array.isArray(e)&&0!==e.length){t.n=1;break}return t.a(2,[]);case 1:return r=e.map(function(t){return t.startsWith("#")?t.toLowerCase():"#".concat(t.toLowerCase())}),t.n=2,this.notes.filter(function(t){if(!t.tags||0===t.tags.length)return!1;var e=t.tags.map(function(t){return t.toLowerCase()});return n?r.every(function(t){return e.includes(t)}):r.some(function(t){return e.includes(t)})}).reverse().toArray();case 2:return t.a(2,t.v)}},t,this)})),function(t){return V.apply(this,arguments)})},{key:"searchNotesStartsWith",value:(F=v(d().m(function t(e){var n,r,o=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"content",e&&0!==e.trim().length){t.n=1;break}return t.a(2,[]);case 1:return r=e.trim().toLowerCase(),t.n=2,this.notes.filter(function(t){return"content"===n?t.content.toLowerCase().startsWith(r):"tags"===n&&t.tags.some(function(t){return t.toLowerCase().startsWith(r)})}).reverse().toArray();case 2:return t.a(2,t.v)}},t,this)})),function(t){return F.apply(this,arguments)})},{key:"fullTextSearch",value:(H=v(d().m(function t(e){var n,r,o,a,c,i,s,l,h,f,v,p=this,g=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:if(r=(n=g.length>1&&void 0!==g[1]?g[1]:{}).highlightMatches,o=void 0!==r&&r,a=n.minWordLength,c=void 0===a?2:a,i=n.stopWords,s=void 0===i?["и","в","на","с","по","для","от","к","до","из"]:i,l=n.limit,h=void 0===l?50:l,e&&!(e.trim().length<c)){t.n=1;break}return t.a(2,[]);case 1:if(0!==(f=e.trim().toLowerCase().split(/\s+/).filter(function(t){return t.length>=c&&!s.includes(t)})).length){t.n=2;break}return t.a(2,[]);case 2:return t.n=3,this.notes.filter(function(t){var e=t.content.toLowerCase(),n=t.tags.join(" ").toLowerCase(),r="".concat(e," ").concat(n);return f.every(function(t){return r.includes(t)})}).reverse().limit(h).toArray();case 3:if(v=t.v,!o){t.n=4;break}return t.a(2,v.map(function(t){return u(u({},t),{},{highlightedContent:p.highlightMatches(t.content,f),highlightedTags:t.tags.map(function(t){return p.highlightMatches(t,f)})})}));case 4:return t.a(2,v)}},t,this)})),function(t){return H.apply(this,arguments)})},{key:"highlightMatches",value:function(t,e){var n=t;return e.forEach(function(t){var e=new RegExp("(".concat(t,")"),"gi");n=n.replace(e,"<mark>$1</mark>")}),n}},{key:"advancedSearch",value:(Y=v(d().m(function t(e){var n,r,o,a,c,i,s,u,l,h,f,v,p,g,y,m,w,b,k,D,E,S,L=this;return d().w(function(t){for(;;)switch(t.n){case 0:return n=e.text,r=void 0===n?"":n,o=e.tags,a=void 0===o?[]:o,c=e.dateFrom,i=void 0===c?null:c,s=e.dateTo,u=void 0===s?null:s,e.hasAttachments,l=e.minLength,h=void 0===l?null:l,f=e.maxLength,v=void 0===f?null:f,p=e.sortBy,g=void 0===p?"date":p,y=e.sortOrder,m=void 0===y?"desc":y,w=e.limit,b=void 0===w?100:w,k=this.notes.toCollection(),(i||u)&&(D=i||new Date("1970-01-01"),E=u||new Date("2099-12-31"),k=this.notes.where("date").between(D,E,!0,!0)),t.n=1,k.filter(function(t){return!(r&&!t.content.toLowerCase().includes(r.toLowerCase())||a.length>0&&!a.some(function(e){return t.tags.some(function(t){return t.toLowerCase().includes(e.toLowerCase())})})||null!==h&&t.content.length<h||null!==v&&t.content.length>v)}).toArray();case 1:return S=t.v,"date"===g?S.sort(function(t,e){var n=new Date(t.date),r=new Date(e.date);return"desc"===m?r-n:n-r}):"relevance"===g&&r&&S.sort(function(t,e){var n=L.calculateRelevance(t,r),o=L.calculateRelevance(e,r);return"desc"===m?o-n:n-o}),t.a(2,S.slice(0,b))}},t,this)})),function(t){return Y.apply(this,arguments)})},{key:"calculateRelevance",value:function(t,e){var n=t.content.toLowerCase(),r=e.toLowerCase(),o=0;return n.includes(r)&&(o+=10),n.startsWith(r)&&(o+=5),t.tags.some(function(t){return t.toLowerCase().includes(r)})&&(o+=8),o}},{key:"getPopularTags",value:(P=v(d().m(function t(){var e,n,r,o=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:20,t.n=1,this.notes.toArray();case 1:return n=t.v,r={},n.forEach(function(t){t.tags.forEach(function(t){r[t]=(r[t]||0)+1})}),t.a(2,Object.entries(r).sort(function(t,e){var n=c(t,2)[1];return c(e,2)[1]-n}).slice(0,e).map(function(t){var e=c(t,2);return{tag:e[0],count:e[1]}}))}},t,this)})),function(){return P.apply(this,arguments)})},{key:"getTagSuggestions",value:(I=v(d().m(function t(e){var n,r,o,a=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:10,e&&!(e.length<1)){t.n=2;break}return t.n=1,this.getPopularTags(n);case 1:return t.a(2,t.v);case 2:return t.n=3,this.notes.toArray();case 3:return r=t.v,o=new Set,r.forEach(function(t){t.tags.forEach(function(t){t.toLowerCase().startsWith(e.toLowerCase())&&o.add(t)})}),t.a(2,Array.from(o).slice(0,n))}},t,this)})),function(t){return I.apply(this,arguments)})},{key:"saveSearchHistory",value:(A=v(d().m(function t(e,n){var r;return d().w(function(t){for(;;)switch(t.n){case 0:r={query:e,resultsCount:n,timestamp:new Date},console.log("Поиск сохранён в историю:",r);case 1:return t.a(2)}},t)})),function(t,e){return A.apply(this,arguments)})},{key:"getAllNotes",value:(R=v(d().m(function t(){return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.notes.reverse().toArray();case 1:return t.a(2,t.v)}},t,this)})),function(){return R.apply(this,arguments)})},{key:"getThisWeekNotes",value:(B=v(d().m(function t(){var e,n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return e=L(D),n=e.start,r=e.end,t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return B.apply(this,arguments)})},{key:"getWeekNotes",value:(W=v(d().m(function t(e){var n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return n=e||o(new Date),(r=new Date(n)).setDate(n.getDate()+7),t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(t){return W.apply(this,arguments)})},{key:"getThisMonthNotes",value:(O=v(d().m(function t(){var e,n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return e=L(E),n=e.start,r=e.end,t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return O.apply(this,arguments)})},{key:"getMonthNotes",value:(j=v(d().m(function t(e,n){var r,o;return d().w(function(t){for(;;)switch(t.n){case 0:return r=new Date(e,n,1),o=new Date(e,n+1,1),t.n=1,this.getNotesByDateRange(r,o,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(t,e){return j.apply(this,arguments)})},{key:"getThisYearNotes",value:(C=v(d().m(function t(){var e,n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return e=L(S),n=e.start,r=e.end,t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return C.apply(this,arguments)})},{key:"getYearNotes",value:(M=v(d().m(function t(){var e,n,r,o=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:return e=(o.length>0&&void 0!==o[0]?o[0]:null)||(new Date).getFullYear(),n=new Date(e,0,1),r=new Date(e+1,0,1),t.n=1,this.getNotesByDateRange(n,r,!0,!1);case 1:return t.a(2,t.v)}},t,this)})),function(){return M.apply(this,arguments)})},{key:"getLastNDaysNotes",value:(T=v(d().m(function t(e){var n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return n=new Date,(r=new Date).setDate(n.getDate()-e),t.n=1,this.getNotesByDateRange(r,n,!0,!0);case 1:return t.a(2,t.v)}},t,this)})),function(t){return T.apply(this,arguments)})},{key:"getLastNWeeksNotes",value:(x=v(d().m(function t(e){var n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return n=new Date,(r=new Date).setDate(n.getDate()-7*e),t.n=1,this.getNotesByDateRange(r,n,!0,!0);case 1:return t.a(2,t.v)}},t,this)})),function(t){return x.apply(this,arguments)})},{key:"getLastNMonthsNotes",value:(N=v(d().m(function t(e){var n,r;return d().w(function(t){for(;;)switch(t.n){case 0:return n=new Date,(r=new Date).setMonth(n.getMonth()-e),t.n=1,this.getNotesByDateRange(r,n,!0,!0);case 1:return t.a(2,t.v)}},t,this)})),function(t){return N.apply(this,arguments)})},{key:"getNotesFromDate",value:(g=v(d().m(function t(e){return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.notes.where("date").aboveOrEqual(e).reverse().toArray();case 1:return t.a(2,t.v)}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"getNotesBeforeDate",value:(f=v(d().m(function t(e){return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.notes.where("date").below(e).reverse().toArray();case 1:return t.a(2,t.v)}},t,this)})),function(t){return f.apply(this,arguments)})},{key:"getNotesStats",value:(h=v(d().m(function t(){var e,n,r,o,a=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:null,t.n=1,this.getYearNotes(e);case 1:for(n=t.v,r={},o=0;o<12;o++)r[o]=0;return n.forEach(function(t){var e=t.date.getMonth();r[e]++}),t.a(2,{totalNotes:n.length,monthlyStats:r,allNotes:n})}},t,this)})),function(){return h.apply(this,arguments)})},{key:"getDailyStats",value:(l=v(d().m(function t(e,n){var r,o;return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getNotesByDateRange(e,n,!0,!0);case 1:return r=t.v,o={},r.forEach(function(t){var e=t.date.toISOString().split("T")[0];o[e]||(o[e]={date:e,count:0,notes:[]}),o[e].count++,o[e].notes.push(t)}),t.a(2,Object.values(o).sort(function(t,e){return new Date(e.date)-new Date(t.date)}))}},t,this)})),function(t,e){return l.apply(this,arguments)})},{key:"getTagStatsForPeriod",value:(s=v(d().m(function t(e,n){var r,o;return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getNotesByDateRange(e,n,!0,!0);case 1:return r=t.v,o={},r.forEach(function(t){t.tags.forEach(function(e){o[e]||(o[e]={tag:e,count:0,notes:[]}),o[e].count++,o[e].notes.push(t)})}),t.a(2,Object.values(o).sort(function(t,e){return e.count-t.count}))}},t,this)})),function(t,e){return s.apply(this,arguments)})},{key:"getNotesPaginated",value:(i=v(d().m(function t(){var e,n,r,o,a,c=arguments;return d().w(function(t){for(;;)switch(t.n){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:0,n=c.length>1&&void 0!==c[1]?c[1]:20,r=c.length>2&&void 0!==c[2]?c[2]:null,o=c.length>3&&void 0!==c[3]?c[3]:null,a=this.notes.orderBy("date").reverse(),r&&o&&(a=this.notes.where("date").between(r,o,!0,!1).reverse()),t.n=1,a.offset(e).limit(n).toArray();case 1:return t.a(2,t.v)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"formatDateRange",value:function(t,e){var n=t.toLocaleDateString("ru-RU"),r=e.toLocaleDateString("ru-RU");return n===r?n:"".concat(n," - ").concat(r)}}],r&&p(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i,s,l,h,f,g,N,x,T,M,C,j,O,W,B,R,A,I,P,Y,H,F,V,_,q,U,G,$,K}(r.Ay));function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,c,i=[],s=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(t,e)||M(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){if(t){if("string"==typeof t)return C(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function j(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof i?r:i,u=Object.create(s.prototype);return O(u,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,h={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return a=e,i=0,s=t,h.n=n,c}};function f(n,r){for(i=n,s=r,e=0;!d&&u&&!o&&e<l.length;e++){var o,a=l[e],f=h.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=f&&((o=n<2&&f<a[1])?(i=0,h.v=r,h.n=a[1]):f<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,h.n=v,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),i=l,s=v;(e=i<2?t:s)||!d;){a||(i?i<3?(i>1&&(h.n=-1),f(i,s)):h.n=s:h.v=s);try{if(u=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(d=h.n<0)?s:n.call(r,h))!==c)break}catch(e){a=t,i=1,s=e}finally{u=1}}return{value:e,done:d}}}(n,o,a),!0),u}var c={};function i(){}function s(){}function u(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(O(e={},r,function(){return this}),e),d=u.prototype=i.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,O(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=u,O(d,"constructor",u),O(u,"constructor",s),s.displayName="GeneratorFunction",O(u,o,"GeneratorFunction"),O(d),O(d,o,"Generator"),O(d,r,function(){return this}),O(d,"toString",function(){return"[object Generator]"}),(j=function(){return{w:a,m:h}})()}function O(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}O=function(t,e,n,r){function a(e,n){O(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},O(t,e,n,r)}function W(t,e,n,r,o,a,c){try{var i=t[a](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,o)}function B(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){W(a,r,o,c,i,"next",t)}function i(t){W(a,r,o,c,i,"throw",t)}c(void 0)})}}function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,A(r.key),r)}}function A(t){var e=function(t){if("object"!=x(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==x(e)?e:e+""}var I,P,Y=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentView="today",this.currentWeekStart=null,this.currentMonth=(new Date).getMonth(),this.currentYear=(new Date).getFullYear(),this.init()},e=[{key:"init",value:function(){console.log("Инициализация ViewManager..."),this.initNavigation(),this.initNavigationArrows(),this.setupEventListeners()}},{key:"initNavigation",value:function(){var t=this,e=document.querySelectorAll(".nav-button");0!==e.length?(console.log("Найдено ".concat(e.length," кнопок навигации")),e.forEach(function(e,n){var r=e.dataset.view;r?(e.addEventListener("click",function(e){e.preventDefault(),console.log("Переключение на вид: ".concat(r)),t.switchView(r)}),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.switchView(r))})):console.warn("Кнопка ".concat(n," не имеет data-view атрибута"))})):console.error("Кнопки навигации не найдены!")}},{key:"switchView",value:(D=B(j().m(function t(e){var n;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("Переключение на вид: ".concat(e)),t.p=1,this.hideAllViews(),this.deactivateAllNavButtons(),this.showView(e)){t.n=2;break}return console.error("Вид ".concat(e," не найден!")),t.a(2);case 2:return this.activateNavButton(e),this.currentView=e,t.n=3,this.loadViewData(e);case 3:console.log("Успешно переключились на вид: ".concat(e)),t.n=5;break;case 4:t.p=4,n=t.v,console.error("Ошибка при переключении на вид ".concat(e,":"),n);case 5:return t.a(2)}},t,this,[[1,4]])})),function(t){return D.apply(this,arguments)})},{key:"hideAllViews",value:function(){document.querySelectorAll("[data-view-content]").forEach(function(t){t.hidden=!0,t.style.display="none"})}},{key:"showView",value:function(t){var e=document.querySelector('[data-view-content="'.concat(t,'"]'));return!!e&&(e.hidden=!1,e.style.display="block",!0)}},{key:"deactivateAllNavButtons",value:function(){document.querySelectorAll(".nav-button").forEach(function(t){t.classList.remove("active"),t.setAttribute("aria-selected","false")})}},{key:"activateNavButton",value:function(t){var e=document.querySelector('[data-view="'.concat(t,'"]'));e&&(e.classList.add("active"),e.setAttribute("aria-selected","true"))}},{key:"loadViewData",value:(k=B(j().m(function t(e){var n,r;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:console.log("Загрузка данных для вида: ".concat(e)),t.p=1,n=e,t.n="today"===n?2:"week"===n?4:"month"===n?6:"year"===n?8:"search"===n?10:11;break;case 2:return t.n=3,this.loadTodayView();case 3:return t.a(3,12);case 4:return t.n=5,this.loadWeekView();case 5:return t.a(3,12);case 6:return t.n=7,this.loadMonthView();case 7:return t.a(3,12);case 8:return t.n=9,this.loadYearView();case 9:return t.a(3,12);case 10:return this.setupSearch(),t.a(3,12);case 11:console.warn("Неизвестный вид: ".concat(e));case 12:t.n=14;break;case 13:t.p=13,r=t.v,console.error("Ошибка загрузки вида ".concat(e,":"),r),this.showError('Ошибка загрузки данных для вида "'.concat(e,'"'));case 14:return t.a(2)}},t,this,[[1,13]])})),function(t){return k.apply(this,arguments)})},{key:"loadTodayView",value:(b=B(j().m(function t(){var e,n,r,o;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return console.log('Загрузка вида "Сегодня"...'),t.p=1,t.n=2,N.getTodayNotes();case 2:if(e=t.v,console.log("Найдено записей за сегодня: ".concat(e.length)),n=e.slice(0,10),this.updateRecentNotesList(n),"function"!=typeof N.getYesterdayNotes){t.n=4;break}return t.n=3,N.getYesterdayNotes();case 3:(r=t.v).length>0&&this.showYesterdayNotes(r.slice(0,5));case 4:t.n=6;break;case 5:t.p=5,o=t.v,console.error('Ошибка загрузки вида "Сегодня":',o),this.showError("Не удалось загрузить записи за сегодня");case 6:return t.a(2)}},t,this,[[1,5]])})),function(){return b.apply(this,arguments)})},{key:"updateRecentNotesList",value:function(t){var e=this,n=document.getElementById("recent-notes-list");if(n)if(0!==t.length){var r=t.map(function(t){return e.createNoteHTML(t,200)}).join("");n.innerHTML='\n      <div class="notes-header">\n        <h4>Последние записи ('.concat(t.length,')</h4>\n        <div class="export-buttons-group">\n          <button class="export-button compact" id="export-today-btn" title="Скопировать записи за сегодня">\n            📋 Копировать\n          </button>\n          <button class="download-button compact" id="download-today-btn" title="Скачать записи за сегодня как .txt">\n            📥 Скачать\n          </button>\n        </div>\n      </div>\n      <div class="notes-list">\n        ').concat(r,"\n      </div>\n    "),console.log("Отображено ".concat(t.length," записей")),this.attachTodayHandlers()}else n.innerHTML='\n        <div class="empty-state">\n          <p>📝 Пока записей нет</p>\n          <p>Начни документировать свои страдания!</p>\n        </div>\n      ';else console.error("Контейнер recent-notes-list не найден!")}},{key:"attachTodayHandlers",value:function(){var t=this,e=document.getElementById("export-today-btn");e&&e.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return e.disabled=!0,e.textContent="⏳",n.n=1,t.exportTodayNotes();case 1:r=n.v,t.showExportNotification(r,!1),e.disabled=!1,e.textContent="📋 Копировать";case 2:return n.a(2)}},n)})));var n=document.getElementById("download-today-btn");n&&n.addEventListener("click",B(j().m(function e(){var r;return j().w(function(e){for(;;)switch(e.n){case 0:return n.disabled=!0,n.textContent="⏳",e.n=1,t.downloadTodayNotes();case 1:r=e.v,t.showExportNotification(r,!0),n.disabled=!1,n.textContent="📥 Скачать";case 2:return e.a(2)}},e)})));var r=document.getElementById("recent-notes-list");r&&r.addEventListener("click",function(e){var n=e.target.closest("button[data-note-id]");if(n){var r=n.dataset.noteId;n.classList.contains("expand-note-btn")&&t.expandNoteContent(r),n.classList.contains("copy-btn")&&t.copyNoteToClipboard(parseInt(r,10)),n.classList.contains("edit-btn")&&t.editNote(parseInt(r,10)),n.classList.contains("delete-btn")&&t.deleteNote(parseInt(r,10))}})}},{key:"expandNoteContent",value:function(t){var e=document.querySelector('.note-item[data-note-id="'.concat(t,'"] .note-content')),n=null==e?void 0:e.querySelector(".content-text"),r=null==e?void 0:e.querySelector(".expand-note-btn");if(e&&n&&r){var o=e.dataset.fullContent;o&&(n.innerHTML=o,n.classList.remove("truncated"),r.remove(),console.log("Раскрыт полный текст записи #".concat(t)))}else console.error("Элементы для раскрытия не найдены:",t)}},{key:"copyNoteToClipboard",value:(w=B(j().m(function t(e){var n,r,o,a;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.notes.get(e);case 1:if(n=t.v){t.n=2;break}return console.error("Запись не найдена:",e),t.a(2);case 2:return r=this.formatSingleNoteForCopy(n),t.n=3,this.copyToClipboard(r);case 3:o=t.v,this.showExportNotification({success:o.success,count:1,period:"запись #".concat(e),error:o.error},!1),t.n=5;break;case 4:t.p=4,a=t.v,console.error("Ошибка копирования записи:",a);case 5:return t.a(2)}},t,this,[[0,4]])})),function(t){return w.apply(this,arguments)})},{key:"formatSingleNoteForCopy",value:function(t){var e=new Date(t.date).toLocaleString("ru-RU"),n=t.tags.length>0?" ".concat(t.tags.join(" ")):"";return"📝 Запись #".concat(t.id," от ").concat(e,"\n\n").concat(t.content).concat(n)}},{key:"deleteNote",value:(m=B(j().m(function t(e){var n,r,o;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n="Точно удалить запись #".concat(e,"?\n\nЭто действие необратимо!"),confirm(n)){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,N.deleteNote(e);case 2:return t.n=3,this.updateCurrentView();case 3:console.log("Запись #".concat(e," удалена")),(r=document.createElement("div")).className="export-notification success",r.innerHTML='\n        <div class="notification-content">\n          <span class="notification-icon">🗑️</span>\n          <div class="notification-text">\n            <strong>Запись удалена</strong>\n            <p>Запись #'.concat(e," была успешно удалена.</p>\n          </div>\n        </div>\n      "),document.body.appendChild(r),setTimeout(function(){return r.classList.add("show")},10),setTimeout(function(){r.classList.remove("show"),setTimeout(function(){r.parentNode&&document.body.removeChild(r)},300)},3e3),t.n=5;break;case 4:t.p=4,o=t.v,console.error("Ошибка удаления записи:",o),alert("Не удалось удалить запись #".concat(e,": ").concat(o.message));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t){return m.apply(this,arguments)})},{key:"editNote",value:(y=B(j().m(function t(e){return j().w(function(t){for(;;)switch(t.n){case 0:console.log("Редактирование записи:",e),alert("Редактирование записи #".concat(e,"\n\nФункция будет добавлена в следующих версиях."));case 1:return t.a(2)}},t)})),function(t){return y.apply(this,arguments)})},{key:"showYesterdayNotes",value:function(t){var e=this,n=document.getElementById("recent-notes-list");if(n&&0!==t.length){var r='\n      <div class="yesterday-notes">\n        <h4>Вчера ('.concat(t.length,')</h4>\n        <div class="notes-list">\n          ').concat(t.map(function(t){return e.createNoteHTML(t)}).join(""),"\n        </div>\n      </div>\n    ");n.insertAdjacentHTML("beforeend",r)}}},{key:"createNoteHTML",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=new Date(t.date),o=new Date;e=this.isSameDay(r,o)?r.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):r.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});var a=t.tags.length>0?'<div class="note-tags">'.concat(t.tags.join(" "),"</div>"):"",c=n&&t.content.length>n,i=c?t.content.substring(0,n)+"...":t.content,s=c?'data-full-content="'.concat(this.escapeHtml(t.content),'"'):"",u=c?'<button class="expand-note-btn" data-note-id="'.concat(t.id,'" title="Показать полный текст">Показать полностью</button>'):"";return'\n      <div class="note-item" data-note-id="'.concat(t.id,'" title="Запись от ').concat(r.toLocaleString("ru-RU"),'">\n        <div class="note-header">\n          <span class="note-time">').concat(e,'</span>\n          <span class="note-id">#').concat(t.id,'</span>\n          <div class="note-actions">\n            <button class="note-action-btn copy-btn" data-note-id="').concat(t.id,'" title="Скопировать запись">📋</button>\n            <button class="note-action-btn edit-btn" data-note-id="').concat(t.id,'" title="Редактировать">✏️</button>\n            <button class="note-action-btn delete-btn" data-note-id="').concat(t.id,'" title="Удалить">🗑️</button>\n          </div>\n        </div>\n        <div class="note-content" ').concat(s,'>\n          <div class="content-text ').concat(c?"truncated":"",'" data-note-id="').concat(t.id,'">\n            ').concat(this.escapeHtml(i),"\n          </div>\n          ").concat(u,"\n        </div>\n        ").concat(a,"\n      </div>\n    ")}},{key:"loadWeekView",value:(g=B(j().m(function t(){var e,n;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return console.log("Загрузка недельного вида..."),t.p=1,this.currentWeekStart||(this.currentWeekStart=this.getWeekStart(new Date)),t.n=2,N.getWeekNotes(this.currentWeekStart);case 2:e=t.v,console.log("Найдено записей за неделю: ".concat(e.length)),this.updateWeekView(e),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Ошибка загрузки недельного вида:",n),this.showError("Не удалось загрузить записи за неделю");case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return g.apply(this,arguments)})},{key:"updateWeekView",value:function(t){var e=this,n=document.getElementById("week-notes-list"),r=document.getElementById("week-title");if(n&&r){var o=new Date(this.currentWeekStart);o.setDate(o.getDate()+6);var a=this.currentWeekStart.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),c=o.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"});if(r.textContent="Неделя ".concat(a," — ").concat(c),0!==t.length){var i=this.groupNotesByDay(t),s=this.getWeekDaysArray(this.currentWeekStart).map(function(t){var n=t.date.toDateString(),r=i[n]||[];return'\n          <div class="week-day '.concat(r.length>0?"has-notes":"",'">\n            <div class="day-header">\n              <h4>').concat(t.name,'</h4>\n              <span class="day-date">').concat(t.date.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),"</span>\n              ").concat(r.length>0?'<span class="notes-count">'.concat(r.length,"</span>"):"",'\n            </div>\n            <div class="day-notes">\n              ').concat(r.length>0?r.map(function(t){return e.createCompactNoteHTML(t)}).join(""):'<p class="no-notes">Записей нет</p>',"\n            </div>\n          </div>\n        ")}).join("");n.innerHTML='\n    <div class="week-controls">\n      <div class="export-buttons-group">\n        <button class="export-button" id="export-week-btn" title="Скопировать все записи за неделю в буфер обмена">\n          📋 Скопировать записи ('.concat(t.length,')\n        </button>\n        <button class="download-button" id="download-week-btn" title="Скачать все записи за неделю как .txt файл">\n          📥 Скачать .txt (').concat(t.length,')\n        </button>\n      </div>\n    </div>\n    <div class="week-grid">\n      ').concat(s,'\n    </div>\n    <div class="week-summary">\n      <p>Всего записей за неделю: <strong>').concat(t.length,"</strong></p>\n      <p>Активных дней: <strong>").concat(Object.keys(i).length,"</strong></p>\n    </div>\n  ");var u=document.getElementById("export-week-btn");u&&u.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return u.disabled=!0,u.textContent="⏳ Копирование...",n.n=1,e.exportWeekNotes();case 1:r=n.v,e.showExportNotification(r,!1),u.disabled=!1,u.textContent="📋 Скопировать записи (".concat(t.length,")");case 2:return n.a(2)}},n)})));var l=document.getElementById("download-week-btn");l&&l.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return l.disabled=!0,l.textContent="⏳ Скачивание...",n.n=1,e.downloadWeekNotes();case 1:r=n.v,e.showExportNotification(r,!0),l.disabled=!1,l.textContent="📥 Скачать .txt (".concat(t.length,")");case 2:return n.a(2)}},n)})))}else n.innerHTML='\n        <div class="empty-state">\n          <p>📅 За эту неделю записей нет</p>\n          <p>Время начать документировать!</p>\n        </div>\n      '}else console.error("Контейнеры для недельного вида не найдены!")}},{key:"loadMonthView",value:(p=B(j().m(function t(){var e,n;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return console.log("Загрузка месячного вида..."),t.p=1,t.n=2,N.getMonthNotes(this.currentYear,this.currentMonth);case 2:e=t.v,console.log("Найдено записей за месяц: ".concat(e.length)),this.updateMonthView(e),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Ошибка загрузки месячного вида:",n),this.showError("Не удалось загрузить записи за месяц");case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return p.apply(this,arguments)})},{key:"updateMonthView",value:function(t){var e=this,n=document.getElementById("month-calendar-grid"),r=document.getElementById("month-title");if(n&&r){r.textContent="".concat(["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][this.currentMonth]," ").concat(this.currentYear);var o=new Date(this.currentYear,this.currentMonth,1),a=new Date(this.currentYear,this.currentMonth+1,0).getDate(),c=0===o.getDay()?6:o.getDay()-1,i={};t.forEach(function(t){var e=t.date.getDate();i[e]||(i[e]=[]),i[e].push(t)});var s='\n    <div class="month-controls">\n      <div class="export-buttons-group">\n        <button class="export-button" id="export-month-btn" title="Скопировать все записи за месяц в буфер обмена">\n          📋 Экспорт месяца ('.concat(t.length,')\n        </button>\n        <button class="download-button" id="download-month-btn" title="Скачать все записи за месяц как .txt файл">\n          📥 Скачать .txt (').concat(t.length,")\n        </button>\n      </div>\n    </div>\n  ");n.parentElement.insertAdjacentHTML("afterbegin",s),n.innerHTML="",n.className="month-calendar-grid",["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].forEach(function(t){var e=document.createElement("div");e.className="calendar-day-header",e.textContent=t,n.appendChild(e)});for(var u=0;u<c;u++){var l=document.createElement("div");l.className="calendar-day empty",n.appendChild(l)}for(var d=new Date,h=function(t){var r=document.createElement("div");r.className="calendar-day";var o=i[t]?i[t].length:0,a=e.currentYear===d.getFullYear()&&e.currentMonth===d.getMonth()&&t===d.getDate(),c="";o>0&&(r.classList.add("has-notes"),c=o>=5?"high-activity":o>=3?"medium-activity":"low-activity",r.classList.add(c)),a&&r.classList.add("today"),r.innerHTML='\n        <div class="day-number">'.concat(t,"</div>\n        ").concat(o>0?'<div class="notes-indicator">'.concat(o,"</div>"):"","\n      "),o>0&&(r.style.cursor="pointer",r.addEventListener("click",function(){e.showDayNotesModal(e.currentYear,e.currentMonth,t,i[t])})),n.appendChild(r)},f=1;f<=a;f++)h(f);var v=document.getElementById("export-month-btn"),p=document.getElementById("download-month-btn");v&&v.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return v.disabled=!0,v.textContent="⏳ Экспортируем...",n.n=1,e.exportMonthNotes();case 1:r=n.v,e.showExportNotification(r,!1),v.disabled=!1,v.textContent="📋 Экспорт месяца (".concat(t.length,")");case 2:return n.a(2)}},n)}))),p&&p.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return p.disabled=!0,p.textContent="⏳ Скачиваем...",n.n=1,e.downloadMonthNotes();case 1:r=n.v,e.showExportNotification(r,!0),p.disabled=!1,p.textContent="📥 Скачать .txt (".concat(t.length,")");case 2:return n.a(2)}},n)})))}else console.error("Контейнеры для месячного вида не найдены!")}},{key:"loadYearView",value:(v=B(j().m(function t(){var e,n;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return console.log("Загрузка годового вида..."),t.p=1,t.n=2,N.getNotesStats(this.currentYear);case 2:e=t.v,console.log("Статистика за год: ".concat(e.totalNotes," записей")),this.updateYearView(e),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Ошибка загрузки годового вида:",n),this.showError("Не удалось загрузить данные за год");case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return v.apply(this,arguments)})},{key:"updateYearView",value:function(t){var e=this,n=document.getElementById("year-calendar-grid"),r=document.querySelector("#year-view h2");if(n&&r){r.textContent="Годовой архив страданий — ".concat(this.currentYear);var o='\n    <div class="year-controls">\n      <div class="export-buttons-group">\n        <button class="export-button" id="export-year-btn" title="Скопировать все записи за год в буфер обмена">\n          📋 Экспорт года ('.concat(t.totalNotes,')\n        </button>\n        <button class="download-button" id="download-year-btn" title="Скачать все записи за год как .txt файл">\n          📥 Скачать .txt (').concat(t.totalNotes,")\n        </button>\n      </div>\n    </div>\n  ");n.parentElement.insertAdjacentHTML("afterbegin",o),n.innerHTML="",n.className="year-calendar-grid";var a=Math.max.apply(Math,function(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||M(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Object.values(t.monthlyStats)).concat([1]));["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"].forEach(function(r,o){var c=t.monthlyStats[o]||0,i=c/a,s=document.createElement("div");s.className="year-month",c>0&&(s.classList.add("has-notes"),i>=.8?s.classList.add("very-high-activity"):i>=.6?s.classList.add("high-activity"):i>=.4?s.classList.add("medium-activity"):s.classList.add("low-activity")),s.innerHTML='\n        <div class="month-header">\n          <span class="month-name">'.concat(r,'</span>\n          <span class="month-number">').concat(o+1,'</span>\n        </div>\n        <div class="month-count">').concat(c,'</div>\n        <div class="month-bar">\n          <div class="month-bar-fill" style="width: ').concat(100*i,'%"></div>\n        </div>\n      '),s.style.cursor="pointer",s.addEventListener("click",function(){e.currentMonth=o,e.switchView("month")}),s.title="".concat(r," ").concat(e.currentYear,": ").concat(c," записей"),n.appendChild(s)});var c=document.getElementById("export-year-btn"),i=document.getElementById("download-year-btn");c&&c.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return c.disabled=!0,c.textContent="⏳ Собираем архив...",n.n=1,e.exportYearNotes();case 1:r=n.v,e.showExportNotification(r,!1),c.disabled=!1,c.textContent="📋 Экспорт года (".concat(t.totalNotes,")");case 2:return n.a(2)}},n)}))),i&&i.addEventListener("click",B(j().m(function n(){var r;return j().w(function(n){for(;;)switch(n.n){case 0:return i.disabled=!0,i.textContent="⏳ Создаём архив...",n.n=1,e.downloadYearNotes();case 1:r=n.v,e.showExportNotification(r,!0),i.disabled=!1,i.textContent="📥 Скачать .txt (".concat(t.totalNotes,")");case 2:return n.a(2)}},n)})))}else console.error("Контейнеры для годового вида не найдены!")}},{key:"setupSearch",value:function(){var t=this;console.log("Настройка поиска...");var e=document.getElementById("search-input"),n=document.getElementById("search-results-list"),r=document.getElementById("search-suggestions");if(e&&n){var o,a="";this.showSearchSuggestions(),e.addEventListener("input",function(e){clearTimeout(o);var c=e.target.value.trim();if(a=c,c.length>0&&r&&(r.innerHTML=""),0===c.length)return t.showSearchSuggestions(),void(n.innerHTML='\n        <div class="search-placeholder">\n          <p>👆 Начните вводить текст для поиска</p>\n          <p>Поиск происходит автоматически по мере ввода</p>\n        </div>\n      ');1!==c.length?(c.length>=2&&(n.innerHTML='\n        <div class="search-loading">\n          <p>🔍 Поиск "'.concat(t.escapeHtml(c),'"...</p>\n        </div>\n      ')),o=setTimeout(B(j().m(function e(){return j().w(function(e){for(;;)switch(e.n){case 0:if(!(c===a&&c.length>=2)){e.n=1;break}return e.n=1,t.performSearch(c);case 1:return e.a(2)}},e)})),300)):n.innerHTML='\n        <div class="search-placeholder">\n          <p>Введите ещё '.concat(2-c.length," символ...</p>\n        </div>\n      ")}),e.addEventListener("keypress",function(){var e=B(j().m(function e(n){var r;return j().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==n.key){e.n=1;break}if(clearTimeout(o),!((r=n.target.value.trim()).length>=2)){e.n=1;break}return e.n=1,t.performSearch(r);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.addEventListener("focus",function(){0===e.value.length&&t.showSearchSuggestions()}),e.addEventListener("blur",function(){setTimeout(function(){0===e.value.length&&r&&(r.innerHTML="")},200)}),e.focus()}else console.error("Элементы поиска не найдены!")}},{key:"performSearch",value:(f=B(j().m(function t(e){var n,r,o,a;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=document.getElementById("search-results-list"),t.p=1,console.log('Выполняется поиск: "'.concat(e,'"')),r=[],!e.startsWith("#")){t.n=3;break}return o=e.substring(1),t.n=2,N.searchByTags([o],!1);case 2:r=t.v,console.log('Поиск по тегу "'.concat(o,'": найдено ').concat(r.length," записей")),t.n=5;break;case 3:return t.n=4,N.searchNotes(e,{searchInContent:!0,searchInTags:!0,caseSensitive:!1,limit:50});case 4:r=t.v,console.log('Текстовый поиск "'.concat(e,'": найдено ').concat(r.length," записей"));case 5:this.displaySearchResults(r,e),t.n=7;break;case 6:t.p=6,a=t.v,console.error("Ошибка поиска:",a),n.innerHTML='\n      <div class="search-error">\n        <p>❌ Ошибка при выполнении поиска</p>\n        <p>Попробуйте ещё раз или перезагрузите страницу</p>\n        <button onclick="location.reload()" class="retry-button">Перезагрузить</button>\n      </div>\n    ';case 7:return t.a(2)}},t,this,[[1,6]])})),function(t){return f.apply(this,arguments)})},{key:"displaySearchResults",value:function(t,e){var n=this,r=document.getElementById("search-results-list");if(0!==t.length){var o=this.groupSearchResultsByDate(t),a=t.length,c='\n    <div class="search-results-header">\n      <h4>✅ Найдено: '.concat(a,' записей</h4>\n      <p>по запросу <strong>"').concat(this.escapeHtml(e),'"</strong></p>\n      ').concat(a>10?"<p><small>Показаны самые релевантные результаты</small></p>":"","\n    </div>\n  "),i=Object.entries(o).sort(function(t,e){var n=T(t,1)[0],r=T(e,1)[0];return new Date(r)-new Date(n)}).map(function(t){var r=T(t,2),o=r[0],a=r[1],c=new Date(o),i=n.formatSearchDate(c);return'\n        <div class="search-day-group">\n          <h5 class="search-day-header">'.concat(i," (").concat(a.length,')</h5>\n          <div class="search-day-results">\n            ').concat(a.map(function(t){return n.createSearchResultHTML(t,e)}).join(""),"\n          </div>\n        </div>\n      ")}).join("");r.innerHTML=c+i,r.scrollIntoView({behavior:"smooth",block:"start"})}else r.innerHTML='\n      <div class="no-results">\n        <h4>😔 Ничего не найдено</h4>\n        <p>По запросу <strong>"'.concat(this.escapeHtml(e),'"</strong> ничего не найдено</p>\n        <div class="search-tips">\n          <h5>💡 Попробуйте:</h5>\n          <ul>\n            <li>Упростить поисковый запрос</li>\n            <li>Проверить правильность написания</li>\n            <li>Использовать другие ключевые слова</li>\n            <li>Поискать по тегам: <code>#работа</code>, <code>#проект</code></li>\n          </ul>\n        </div>\n      </div>\n    ')}},{key:"groupSearchResultsByDate",value:function(t){var e={};return t.forEach(function(t){var n=t.date.toDateString();e[n]||(e[n]=[]),e[n].push(t)}),e}},{key:"createSearchResultHTML",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=new Date(t.date).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),o=this.escapeHtml(t.content);if(n&&!n.startsWith("#")){var a=new RegExp("(".concat(this.escapeRegex(n),")"),"gi");o=o.replace(a,"<mark>$1</mark>")}var c=t.tags.map(function(t){if(n.startsWith("#")&&t.toLowerCase().includes(n.substring(1).toLowerCase())){var r=new RegExp("(".concat(e.escapeRegex(n.substring(1)),")"),"gi");return t.replace(r,"<mark>$1</mark>")}return t}),i=c.length>0?'<div class="search-result-tags">'.concat(c.join(" "),"</div>"):"";return'\n    <div class="search-result-item" data-note-id="'.concat(t.id,'">\n      <div class="search-result-header">\n        <span class="search-result-time">').concat(r,'</span>\n        <span class="search-result-id">#').concat(t.id,'</span>\n      </div>\n      <div class="search-result-content">').concat(o,"</div>\n      ").concat(i,"\n    </div>\n  ")}},{key:"showSearchSuggestions",value:(h=B(j().m(function t(){var e,n,r,o,a,c=this;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.getElementById("search-suggestions")){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,N.getPopularTags;case 2:if(!t.v){t.n=4;break}return t.n=3,N.getPopularTags(8);case 3:o=t.v,t.n=5;break;case 4:o=[];case 5:(n=o).length>0?(r='\n        <div class="suggestions">\n          <h5>🏷️ Популярные теги:</h5>\n          <div class="tag-suggestions">\n            '.concat(n.map(function(t){var e=t.tag,n=t.count;return'<button class="tag-suggestion" data-tag="'.concat(e,'" title="').concat(n,' записей">\n                ').concat(e,' <span class="tag-count">(').concat(n,")</span>\n              </button>")}).join(""),'\n          </div>\n          <div class="search-examples">\n            <h5>💡 Примеры поиска:</h5>\n            <div class="example-queries">\n              <button class="example-query" data-query="встреча">встреча</button>\n              <button class="example-query" data-query="#баг">#баг</button>\n              <button class="example-query" data-query="проект">проект</button>\n              <button class="example-query" data-query="#важно">#важно</button>\n            </div>\n          </div>\n        </div>\n      '),e.innerHTML=r,e.querySelectorAll(".tag-suggestion").forEach(function(t){t.addEventListener("click",function(t){var e=t.target.dataset.tag||t.target.closest("[data-tag]").dataset.tag,n=document.getElementById("search-input");n.value=e,n.focus(),c.performSearch(e)})}),e.querySelectorAll(".example-query").forEach(function(t){t.addEventListener("click",function(t){var e=t.target.dataset.query,n=document.getElementById("search-input");n.value=e,n.focus(),c.performSearch(e)})})):e.innerHTML='\n        <div class="suggestions">\n          <div class="search-examples">\n            <h5>💡 Как искать:</h5>\n            <ul>\n              <li><strong>По тексту:</strong> просто введите слово или фразу</li>\n              <li><strong>По тегам:</strong> начните с # (например: #работа)</li>\n              <li><strong>Поиск живой:</strong> результаты появляются по мере ввода</li>\n            </ul>\n          </div>\n        </div>\n      ',t.n=7;break;case 6:t.p=6,a=t.v,console.error("Ошибка загрузки подсказок:",a);case 7:return t.a(2)}},t,null,[[1,6]])})),function(){return h.apply(this,arguments)})},{key:"formatSearchDate",value:function(t){var e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(n.getTime()-864e5);if(t>=n)return"🕒 Сегодня";if(t>=r)return"📅 Вчера";var o=Math.floor((n-t)/864e5);return o<=7?"📆 ".concat(o," дней назад"):t.toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long",year:t.getFullYear()!==e.getFullYear()?"numeric":void 0})}},{key:"escapeRegex",value:function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},{key:"copyToClipboard",value:(d=B(j().m(function t(e){var n,r,o;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!navigator.clipboard||!navigator.clipboard.writeText){t.n=2;break}return t.n=1,navigator.clipboard.writeText(e);case 1:return t.a(2,{success:!0,method:"modern"});case 2:if(!document.queryCommandSupported||!document.queryCommandSupported("copy")){t.n=3;break}if((n=document.createElement("textarea")).value=e,n.style.position="fixed",n.style.left="-9999px",n.style.top="-9999px",document.body.appendChild(n),n.focus(),n.select(),r=document.execCommand("copy"),document.body.removeChild(n),!r){t.n=3;break}return t.a(2,{success:!0,method:"fallback"});case 3:throw new Error("Clipboard API не поддерживается в этом браузере");case 4:return t.p=4,o=t.v,console.error("Ошибка копирования:",o),t.a(2,{success:!1,error:o.message});case 5:return t.a(2)}},t,null,[[0,4]])})),function(t){return d.apply(this,arguments)})},{key:"formatNotesForExport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t||0===t.length)return"📋 Архив Потраченного Времени ".concat(e,"\n\nЗаписей не найдено.");var n="📋 Архив Потраченного Времени ".concat(e,"\n")+"Экспортировано: ".concat((new Date).toLocaleString("ru-RU"),"\n")+"Всего записей: ".concat(t.length,"\n")+"".concat("=".repeat(50),"\n\n"),r=this.groupNotesByDay(t),o=n,a=Object.keys(r).sort(function(t,e){return new Date(e)-new Date(t)});a.forEach(function(t,e){var n=r[t],a=new Date(t),c="📅 ".concat(a.toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," (").concat(n.length," записей)");o+="".concat(c,"\n").concat("-".repeat(40),"\n"),n.sort(function(t,e){return new Date(t.date)-new Date(e.date)}).forEach(function(t,e){var n=t.date.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),r=t.tags.length>0?" ".concat(t.tags.join(" ")):"";o+="".concat(e+1,". [").concat(n,"] ").concat(t.content).concat(r,"\n")}),o+="\n"});var c="".concat("=".repeat(50),"\n")+"Создано в Архиве Потраченного Времени\n"+"Всего дней с записями: ".concat(a.length,"\n")+"Общее количество записей: ".concat(t.length);return o+=c}},{key:"exportTodayNotes",value:(l=B(j().m(function t(){var e,n,r,o,a;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getTodayNotes();case 1:return e=t.v,n=(new Date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}),r=this.formatNotesForExport(e,"- ".concat(n)),t.n=2,this.copyToClipboard(r);case 2:return o=t.v,t.a(2,{success:o.success,count:e.length,period:"сегодня",error:o.error});case 3:return t.p=3,a=t.v,console.error("Ошибка экспорта записей за сегодня:",a),t.a(2,{success:!1,error:a.message})}},t,this,[[0,3]])})),function(){return l.apply(this,arguments)})},{key:"exportWeekNotes",value:(u=B(j().m(function t(){var e,n,r,o,a,c;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.currentWeekStart||(this.currentWeekStart=this.getWeekStart(new Date)),t.n=1,N.getWeekNotes(this.currentWeekStart);case 1:return e=t.v,(n=new Date(this.currentWeekStart)).setDate(n.getDate()+6),r="- Неделя с ".concat(this.currentWeekStart.toLocaleDateString("ru-RU")," по ").concat(n.toLocaleDateString("ru-RU")),o=this.formatNotesForExport(e,r),t.n=2,this.copyToClipboard(o);case 2:return a=t.v,t.a(2,{success:a.success,count:e.length,period:"неделю",error:a.error});case 3:return t.p=3,c=t.v,console.error("Ошибка экспорта записей за неделю:",c),t.a(2,{success:!1,error:c.message})}},t,this,[[0,3]])})),function(){return u.apply(this,arguments)})},{key:"exportMonthNotes",value:(s=B(j().m(function t(){var e,n,r,o,a;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getMonthNotes(this.currentYear,this.currentMonth);case 1:return e=t.v,n="- ".concat(["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"][this.currentMonth]," ").concat(this.currentYear),r=this.formatNotesForExport(e,n),t.n=2,this.copyToClipboard(r);case 2:return o=t.v,t.a(2,{success:o.success,count:e.length,period:"месяц",error:o.error});case 3:return t.p=3,a=t.v,console.error("Ошибка экспорта записей за месяц:",a),t.a(2,{success:!1,error:a.message})}},t,this,[[0,3]])})),function(){return s.apply(this,arguments)})},{key:"exportYearNotes",value:(i=B(j().m(function t(){var e,n,r,o,a;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getNotesStats(this.currentYear);case 1:return e=t.v,n="- ".concat(this.currentYear," год"),r=this.formatNotesForExport(e.allNotes,n),t.n=2,this.copyToClipboard(r);case 2:return o=t.v,t.a(2,{success:o.success,count:e.totalNotes,period:"год",error:o.error});case 3:return t.p=3,a=t.v,console.error("Ошибка экспорта записей за год:",a),t.a(2,{success:!1,error:a.message})}},t,this,[[0,3]])})),function(){return i.apply(this,arguments)})},{key:"downloadBlob",value:function(t,e){try{var n=URL.createObjectURL(t),r=document.createElement("a");return r.href=n,r.download=e,r.style.display="none",document.body.appendChild(r),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(r),setTimeout(function(){URL.revokeObjectURL(n)},100),{success:!0}}catch(t){return console.error("Ошибка скачивания файла:",t),{success:!1,error:t.message}}}},{key:"generateReportFilename",value:function(t,e){var n=new Date,r=n.toISOString().split("T")[0],o=n.toTimeString().split(" ")[0].replace(/:/g,"-"),a=t.replace(/\s+/g,"_").replace(/[^\w\-_]/g,"");return a&&(a="_".concat(a)),"archive_report".concat(a,"_").concat(r,"_").concat(o,".txt")}},{key:"downloadTodayNotes",value:(c=B(j().m(function t(){var e,n,r,o,a,c,i;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getTodayNotes();case 1:return e=t.v,n=(new Date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}),r=this.formatNotesForExport(e,"- ".concat(n)),o=new Blob([r],{type:"text/plain;charset=utf-8"}),a=this.generateReportFilename("сегодня",e),c=this.downloadBlob(o,a),t.a(2,{success:c.success,count:e.length,period:"сегодня",filename:a,error:c.error});case 2:return t.p=2,i=t.v,console.error("Ошибка скачивания записей за сегодня:",i),t.a(2,{success:!1,error:i.message})}},t,this,[[0,2]])})),function(){return c.apply(this,arguments)})},{key:"downloadWeekNotes",value:(a=B(j().m(function t(){var e,n,r,o,a,c,i,s;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.currentWeekStart||(this.currentWeekStart=this.getWeekStart(new Date)),t.n=1,N.getWeekNotes(this.currentWeekStart);case 1:return e=t.v,(n=new Date(this.currentWeekStart)).setDate(n.getDate()+6),r="- Неделя с ".concat(this.currentWeekStart.toLocaleDateString("ru-RU")," по ").concat(n.toLocaleDateString("ru-RU")),o=this.formatNotesForExport(e,r),a=new Blob([o],{type:"text/plain;charset=utf-8"}),c=this.generateReportFilename("неделя",e),i=this.downloadBlob(a,c),t.a(2,{success:i.success,count:e.length,period:"неделю",filename:c,error:i.error});case 2:return t.p=2,s=t.v,console.error("Ошибка скачивания записей за неделю:",s),t.a(2,{success:!1,error:s.message})}},t,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"downloadMonthNotes",value:(o=B(j().m(function t(){var e,n,r,o,a,c,i,s;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getMonthNotes(this.currentYear,this.currentMonth);case 1:return e=t.v,r="- ".concat((n=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"])[this.currentMonth]," ").concat(this.currentYear),o=this.formatNotesForExport(e,r),a=new Blob([o],{type:"text/plain;charset=utf-8"}),c=this.generateReportFilename("".concat(n[this.currentMonth],"_").concat(this.currentYear),e),i=this.downloadBlob(a,c),t.a(2,{success:i.success,count:e.length,period:"месяц",filename:c,error:i.error});case 2:return t.p=2,s=t.v,console.error("Ошибка скачивания записей за месяц:",s),t.a(2,{success:!1,error:s.message})}},t,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"downloadYearNotes",value:(r=B(j().m(function t(){var e,n,r,o,a,c,i;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,N.getNotesStats(this.currentYear);case 1:return e=t.v,n="- ".concat(this.currentYear," год"),r=this.formatNotesForExport(e.allNotes,n),o=new Blob([r],{type:"text/plain;charset=utf-8"}),a=this.generateReportFilename("".concat(this.currentYear,"_год"),e.allNotes),c=this.downloadBlob(o,a),t.a(2,{success:c.success,count:e.totalNotes,period:"год",filename:a,error:c.error});case 2:return t.p=2,i=t.v,console.error("Ошибка скачивания записей за год:",i),t.a(2,{success:!1,error:i.message})}},t,this,[[0,2]])})),function(){return r.apply(this,arguments)})},{key:"showExportNotification",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.success,r=t.count,o=t.period,a=t.filename,c=t.error,i=document.createElement("div");i.className="export-notification ".concat(n?"success":"error"),i.innerHTML=n?'\n      <div class="notification-content">\n        <span class="notification-icon">'.concat(e?"📥":"✅",'</span>\n        <div class="notification-text">\n          <strong>').concat(e?"Файл скачан!":"Экспорт завершён!","</strong>\n          <p>").concat(e?"Сохранён файл с ".concat(r," записями за ").concat(o):"Скопировано ".concat(r," записей за ").concat(o," в буфер обмена"),"</p>\n          ").concat(a?'<p class="filename">📄 '.concat(a,"</p>"):"","\n        </div>\n      </div>\n    "):'\n      <div class="notification-content">\n        <span class="notification-icon">❌</span>\n        <div class="notification-text">\n          <strong>'.concat(e?"Ошибка скачивания":"Ошибка экспорта","</strong>\n          <p>").concat(c||"Не удалось выполнить операцию","</p>\n        </div>\n      </div>\n    "),document.body.appendChild(i),setTimeout(function(){return i.classList.add("show")},10),setTimeout(function(){i.classList.remove("show"),setTimeout(function(){i.parentNode&&document.body.removeChild(i)},300)},5e3),i.addEventListener("click",function(){i.classList.remove("show"),setTimeout(function(){i.parentNode&&document.body.removeChild(i)},300)})}},{key:"showDayNotesModal",value:function(t,e,n,r){var o=new Date(t,e,n).toLocaleDateString("ru-RU"),a="Записи за ".concat(o,":\n\n");r.forEach(function(t,e){var n=t.date.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});a+="".concat(e+1,". [").concat(n,"] ").concat(t.content,"\n"),t.tags.length>0&&(a+="   Теги: ".concat(t.tags.join(" "),"\n")),a+="\n"}),alert(a)}},{key:"groupNotesByDay",value:function(t){var e={};return t.forEach(function(t){var n=t.date.toDateString();e[n]||(e[n]=[]),e[n].push(t)}),e}},{key:"getWeekDaysArray",value:function(t){for(var e=[],n=["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],r=0;r<7;r++){var o=new Date(t);o.setDate(t.getDate()+r),e.push({name:n[r],date:o})}return e}},{key:"createCompactNoteHTML",value:function(t){var e=t.date.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),n=t.content.length>100?t.content.substring(0,100)+"...":t.content;return'\n      <div class="compact-note" data-note-id="'.concat(t.id,'">\n        <span class="compact-time">').concat(e,'</span>\n        <span class="compact-content">').concat(this.escapeHtml(n),"</span>\n        ").concat(t.tags.length>0?'<span class="compact-tags">'.concat(t.tags.slice(0,2).join(" "),"</span>"):"","\n      </div>\n    ")}},{key:"getMostActiveMonth",value:function(t){var e=0,n=0;return Object.entries(t).forEach(function(t){var r=T(t,2),o=r[0],a=r[1];a>n&&(n=a,e=parseInt(o))}),["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e]}},{key:"getWeekStart",value:function(t){var e=new Date(t),n=e.getDay(),r=e.getDate()-n+(0===n?-6:1),o=new Date(e.setDate(r));return o.setHours(0,0,0,0),o}},{key:"isSameDay",value:function(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}},{key:"escapeHtml",value:function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML}},{key:"showError",value:function(t){console.error("ViewManager Error:",t);var e=document.querySelector("[data-view-content]:not([hidden])");if(e){var n='\n        <div class="error-message">\n          <p>⚠️ '.concat(t,'</p>\n          <button onclick="location.reload()">Перезагрузить</button>\n        </div>\n      ');e.innerHTML=n}}},{key:"updateCurrentView",value:(n=B(j().m(function t(){return j().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.loadViewData(this.currentView);case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"initNavigationArrows",value:function(){var t=this,e=document.querySelectorAll("#week-view .nav-arrow");e.length>=2&&(e[0].addEventListener("click",function(){return t.navigateWeek(-1)}),e[1].addEventListener("click",function(){return t.navigateWeek(1)}));var n=document.querySelectorAll("#month-view .nav-arrow");n.length>=2&&(n[0].addEventListener("click",function(){return t.navigateMonth(-1)}),n[1].addEventListener("click",function(){return t.navigateMonth(1)}))}},{key:"navigateWeek",value:function(t){this.currentWeekStart||(this.currentWeekStart=this.getWeekStart(new Date)),this.currentWeekStart.setDate(this.currentWeekStart.getDate()+7*t),this.loadWeekView()}},{key:"navigateMonth",value:function(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.loadMonthView()}},{key:"setupEventListeners",value:function(){var t=this;document.addEventListener("keydown",function(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"1":e.preventDefault(),t.switchView("today");break;case"2":e.preventDefault(),t.switchView("week");break;case"3":e.preventDefault(),t.switchView("month");break;case"4":e.preventDefault(),t.switchView("year");break;case"f":e.preventDefault(),t.switchView("search")}}),console.log("Настроены клавиатурные сокращения: Ctrl+1-4 для переключения видов, Ctrl+F для поиска")}}],e&&R(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,a,c,i,s,u,l,d,h,f,v,p,g,y,m,w,b,k,D}();function H(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof i?r:i,u=Object.create(s.prototype);return F(u,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,h={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return a=e,i=0,s=t,h.n=n,c}};function f(n,r){for(i=n,s=r,e=0;!d&&u&&!o&&e<l.length;e++){var o,a=l[e],f=h.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=f&&((o=n<2&&f<a[1])?(i=0,h.v=r,h.n=a[1]):f<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,h.n=v,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),i=l,s=v;(e=i<2?t:s)||!d;){a||(i?i<3?(i>1&&(h.n=-1),f(i,s)):h.n=s:h.v=s);try{if(u=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(d=h.n<0)?s:n.call(r,h))!==c)break}catch(e){a=t,i=1,s=e}finally{u=1}}return{value:e,done:d}}}(n,o,a),!0),u}var c={};function i(){}function s(){}function u(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(F(e={},r,function(){return this}),e),d=u.prototype=i.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,F(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=u,F(d,"constructor",u),F(u,"constructor",s),s.displayName="GeneratorFunction",F(u,o,"GeneratorFunction"),F(d),F(d,o,"Generator"),F(d,r,function(){return this}),F(d,"toString",function(){return"[object Generator]"}),(H=function(){return{w:a,m:h}})()}function F(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}F=function(t,e,n,r){function a(e,n){F(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},F(t,e,n,r)}function V(t,e,n,r,o,a,c){try{var i=t[a](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,o)}function _(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){V(a,r,o,c,i,"next",t)}function i(t){V(a,r,o,c,i,"throw",t)}c(void 0)})}}function q(){var t=document.getElementById("install-pwa-btn");t&&(t.style.display="none")}"serviceWorker"in navigator&&(window.addEventListener("load",_(H().m(function t(){var e,n;return H().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"});case 1:e=t.v,console.log("✅ Workbox Service Worker зарегистрирован:",e.scope),setInterval(function(){e.update()},6e4),e.addEventListener("updatefound",function(){var t=e.installing;t&&t.addEventListener("statechange",function(){var e;"installed"===t.state&&navigator.serviceWorker.controller&&((e=document.createElement("div")).className="export-notification update-notification",e.innerHTML='\n    <div class="notification-content">\n      <span class="notification-icon">🔄</span>\n      <div class="notification-text">\n        <strong>Обновление доступно!</strong>\n        <p>Новая версия приложения готова к установке</p>\n        <button id="update-sw-btn" class="update-button">Обновить сейчас</button>\n      </div>\n    </div>\n  ',document.body.appendChild(e),setTimeout(function(){return e.classList.add("show")},10),e.querySelector("#update-sw-btn").addEventListener("click",function(){navigator.serviceWorker.ready.then(function(t){t.waiting&&t.waiting.postMessage({type:"SKIP_WAITING"})})}),setTimeout(function(){e.classList.remove("show"),setTimeout(function(){return e.remove()},300)},1e4))})}),t.n=3;break;case 2:t.p=2,n=t.v,console.error("❌ Ошибка регистрации Workbox Service Worker:",n);case 3:return t.a(2)}},t,null,[[0,2]])}))),navigator.serviceWorker.addEventListener("message",function(t){t.data&&"CACHE_UPDATED"===t.data.type&&console.log("📦 Кэш обновлён:",t.data.payload)}),navigator.serviceWorker.addEventListener("controllerchange",function(){I||(window.location.reload(),I=!0)})),window.addEventListener("beforeinstallprompt",function(t){console.log("PWA готово к установке"),t.preventDefault(),P=t,function(){var t=document.getElementById("install-pwa-btn");if(!t){(t=document.createElement("button")).id="install-pwa-btn",t.className="install-pwa-button",t.innerHTML="📱 Установить приложение",t.title="Установить Архив Потраченного Времени как приложение";var e=document.getElementById("main-nav");e&&e.appendChild(t)}t.style.display="inline-flex",t.addEventListener("click",_(H().m(function t(){var e,n,r;return H().w(function(t){for(;;)switch(t.p=t.n){case 0:if(P){t.n=1;break}return t.a(2);case 1:return t.p=1,P.prompt(),t.n=2,P.userChoice;case 2:e=t.v,n=e.outcome,console.log("Пользователь ".concat("accepted"===n?"согласился":"отказался"," установить PWA")),P=null,q(),t.n=4;break;case 3:t.p=3,r=t.v,console.error("Ошибка установки PWA:",r);case 4:return t.a(2)}},t,null,[[1,3]])})))}()}),window.addEventListener("appinstalled",function(){var t;console.log("PWA успешно установлено"),P=null,q(),(t=document.createElement("div")).className="export-notification success",t.innerHTML='\n    <div class="notification-content">\n      <span class="notification-icon">✅</span>\n      <div class="notification-text">\n        <strong>Приложение установлено!</strong>\n        <p>Архив Потраченного Времени теперь доступен с главного экрана.</p>\n      </div>\n    </div>\n  ',document.body.appendChild(t),setTimeout(function(){return t.classList.add("show")},10),setTimeout(function(){t.classList.remove("show"),setTimeout(function(){return t.remove()},300)},5e3)}),document.addEventListener("DOMContentLoaded",function(){console.log("Архив Потраченного Времени запускается...");var t=new Y;!function(t){var e=document.getElementById("new-note-form"),n=document.getElementById("note-content"),r=document.getElementById("note-tags"),o=document.getElementById("save-note-btn");function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранить и страдать дальше";o.disabled=!t,o.textContent=e,n.disabled=!t,r.disabled=!t}e?(e.addEventListener("submit",function(){var e=_(H().m(function e(o){var c,i,s,u,l;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o.preventDefault(),c=n.value.trim(),i=r.value.trim(),c){e.n=1;break}return alert("Эй, мудила! Пустые записи никому не нужны. Напиши хоть что-нибудь осмысленное."),n.focus(),e.a(2);case 1:return s=[],i&&(s=i.split(",").map(function(t){return t.trim()}).filter(function(t){return t.length>0}).map(function(t){return t.startsWith("#")?t:"#".concat(t)})),e.p=2,a(!1,"Сохраняю твои страдания..."),e.n=3,N.addNote(c,s);case 3:return u=e.v,console.log("Запись сохранена с ID: ".concat(u)),n.value="",r.value="",a(!0,"Сохранено!"),setTimeout(function(){a(!0,"Сохранить и страдать дальше")},2e3),n.focus(),e.n=4,t.updateCurrentView();case 4:e.n=6;break;case 5:e.p=5,l=e.v,console.error("Ошибка при сохранении записи:",l),alert("Что-то пошло не так. Твои страдания не сохранились. Проверь консоль."),a(!0);case 6:return e.a(2)}},e,null,[[2,5]])}));return function(t){return e.apply(this,arguments)}}()),n.focus()):console.error("Форма добавления записей не найдена!")}(t),t.switchView("today"),console.log("Приложение готово к использованию")})}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var a=n[t]={exports:{}};return e[t].call(a.exports,a,a.exports,r),a.exports}r.m=e,t=[],r.O=(e,n,o,a)=>{if(!n){var c=1/0;for(l=0;l<t.length;l++){for(var[n,o,a]=t[l],i=!0,s=0;s<n.length;s++)(!1&a||c>=a)&&Object.keys(r.O).every(t=>r.O[t](n[s]))?n.splice(s--,1):(i=!1,a<c&&(c=a));if(i){t.splice(l--,1);var u=o();void 0!==u&&(e=u)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[n,o,a]},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={792:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var o,a,[c,i,s]=n,u=0;if(c.some(e=>0!==t[e])){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(s)var l=s(r)}for(e&&e(n);u<c.length;u++)a=c[u],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(l)},n=self.webpackChunktime_archive=self.webpackChunktime_archive||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var o=r.O(void 0,[143],()=>r(91));o=r.O(o)})();